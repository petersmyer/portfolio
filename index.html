<script>
/* ---------- COURSE CONTENT (keeps the pizzazz) ---------- */
function openFullCourse() {
  const modal = document.getElementById('courseModal');
  const frame = document.getElementById('courseFrame');

  frame.innerHTML = `
  <div style="background: linear-gradient(135deg,#ffeaa7 0%,#fab1a0 50%,#74b9ff 100%); min-height: 100%; padding: 28px;">
    <div style="background:#fff; border-radius:20px; border:4px solid #2d3436; box-shadow:0 20px 40px rgba(0,0,0,.1); max-width:820px; margin:0 auto; overflow:hidden">
      <div id="progressBar" style="height:6px; background:linear-gradient(90deg,#00b894,#00cec9); width:8%; transition:width .3s;"></div>
      <div style="padding:36px 28px; text-align:center">
        <h1 style="font-size:2.25rem; margin:0 0 10px; color:#2d3436; text-shadow:2px 2px 0 #fdcb6e; font-weight:800">ğŸ¥£ Breakfast Basics</h1>
        <div style="font-size:3rem; margin:10px 0; animation:bounce 2s infinite">ğŸ¥›ğŸ¥„ğŸŒ¾</div>
        <p style="max-width:620px; margin:0 auto 18px; color:#636e72">
          Learn the ancient art of cereal prep in a few delightful steps.
        </p>

        <div id="courseStep"></div>

        <div style="margin-top:18px; display:flex; justify-content:center; gap:12px">
          <button id="prevBtn" class="cartoon-button" style="background:#fff; padding:12px 20px">â¬…ï¸ Back</button>
          <button id="nextBtn" class="cartoon-button bg-blue-600 text-white" style="padding:12px 20px">Next â¡ï¸</button>
        </div>
      </div>
    </div>
  </div>
  <style>
    @keyframes bounce {0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-14px)}60%{transform:translateY(-8px)}}
  </style>`;

  // Mini-flow with progress
  const progress = document.getElementById('progressBar');
  const stepEl = document.getElementById('courseStep');
  const prev = document.getElementById('prevBtn');
  const next = document.getElementById('nextBtn');
  let i = 0;
  const state = { cereal: '', milk: '', order: '' };

  const screens = [
    () => `
      <h2 class="text-2xl" style="margin:12px 0 8px">Step 1 â€” Pick a cereal</h2>
      <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:10px; max-width:620px; margin:0 auto">
        ${opt("state.cereal='Flakes'","âœ¨ Flakes")}
        ${opt("state.cereal='Cocoa'","ğŸ« Cocoa")}
        ${opt("state.cereal='Oats'","ğŸŒ¾ Oats")}
        ${opt("state.cereal='Corn'","ğŸŒ½ Corn")}
      </div>
      ${helper('Choose your crunch vehicle.')}
    `,
    () => `
      <h2 class="text-2xl" style="margin:12px 0 8px">Step 2 â€” Pick a milk</h2>
      <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:10px; max-width:620px; margin:0 auto">
        ${opt("state.milk='Whole'","ğŸ¥› Whole")}
        ${opt("state.milk='2%'","ğŸ¥› 2%")}
        ${opt("state.milk='Almond'","ğŸŒ° Almond")}
        ${opt("state.milk='Oat'","ğŸŒ¾ Oat")}
      </div>
      ${helper('Yes, chocolate milk is a personality.')}
    `,
    () => `
      <h2 class="text-2xl" style="margin:12px 0 8px">Step 3 â€” The eternal question</h2>
      <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:10px; max-width:620px; margin:0 auto">
        ${opt("state.order='cereal'","ğŸ¥£ â†’ ğŸ¥›  (ratio control)")}
        ${opt("state.order='milk'","ğŸ¥› â†’ ğŸ¥£  (level control)")}
      </div>
      ${helper('There is no wrong answer. Only judgment.')}
    `,
    () => `
      <h2 class="text-2xl" style="margin:12px 0 8px">You did it! ğŸ‰</h2>
      <p style="margin:6px 0 12px">Cereal: <b>${state.cereal||'â€”'}</b> â€¢ Milk: <b>${state.milk||'â€”'}</b> â€¢ Order: <b>${state.order ? (state.order==='milk'?'Milk â†’ Cereal':'Cereal â†’ Milk') : 'â€”'}</b></p>
      <p style="margin-bottom:14px"><i>${state.order==='milk'?'Youâ€™re a Splashâ€‘Tactician.':'Youâ€™re a Ratioâ€‘Regulator.'}</i></p>
      <a id="dlAid" class="cartoon-button bg-green-600 text-white" style="padding:10px 18px; display:inline-block">Download Job Aid ğŸ“„</a>
      <a href="resume.pdf" download class="cartoon-button bg-indigo-600 text-white" style="padding:10px 18px; display:inline-block; margin-left:8px">Resume â¬‡ï¸</a>
    `
  ];

  function opt(js, label) {
    return `<button class="cartoon-button" style="background:#fff; padding:10px" onclick="${js}; this.classList.add('selected')">${label}</button>`;
  }
  function helper(text) {
    return `<div style="opacity:.7; margin-top:8px">${text}</div>`;
  }
  function render() {
    stepEl.innerHTML = screens[i]();
    progress.style.width = ((i+1)/screens.length*100) + '%';
    prev.style.visibility = i ? 'visible' : 'hidden';
    if (i === screens.length - 1) {
      const dl = document.getElementById('dlAid');
      if (dl) dl.addEventListener('click', (e)=>{ e.preventDefault(); downloadJobAid(state); });
      next.textContent = 'Restart â†»';
    } else {
      next.textContent = 'Next â¡ï¸';
    }
  }
  prev.onclick = () => { if (i>0) { i--; render(); } };
  next.onclick = () => {
    if (i===0 && !state.cereal) return nudge('Pick a cereal ğŸ™‚');
    if (i===1 && !state.milk) return nudge('Pick your milk ğŸ¥›');
    if (i===2 && !state.order) return nudge('Choose your side!');
    i = (i >= screens.length-1) ? 0 : i+1;
    render();
  };
  function nudge(msg){
    const m = document.createElement('div');
    m.textContent = msg;
    m.style.cssText = 'margin-top:8px;color:#2d3436;background:#ffeaa7;border:2px solid #2d3436;display:inline-block;padding:6px 10px;border-radius:10px';
    stepEl.appendChild(m);
    setTimeout(()=>m.remove(), 1300);
  }
  render();
  modal.classList.add('active');
}

/* ---------- JOB AID (styled, printable) ---------- */
function downloadJobAid(state = {cereal:'', milk:'', order:''}) {
  const ordText = state.order ? (state.order==='milk' ? 'Milk â†’ Cereal (Splashâ€‘Tactician)' : 'Cereal â†’ Milk (Ratioâ€‘Regulator)') : 'â€”';
  const html = `<!doctype html><meta charset="utf-8"><title>Quick Guide: Cereal</title>
  <style>
    body{font-family:Arial,system-ui,sans-serif;max-width:720px;margin:24px auto;line-height:1.55}
    h1{margin:0 0 12px}
    .b{border:2px solid #222; border-radius:10px; padding:12px; margin:10px 0}
    .n{display:inline-block;width:26px;height:26px; border-radius:50%; background:#222;color:#fff;text-align:center; line-height:26px; font-weight:800; margin-right:6px}
    @media print {.no{display:none}}
  </style>
  <h1>Quick Guide: Bowl of Cereal</h1>
  <div class="b"><b>Cereal:</b> ${state.cereal||'â€”'} &nbsp; <b>Milk:</b> ${state.milk||'â€”'} &nbsp; <b>Order:</b> ${ordText}</div>
  <p><span class="n">1</span>Gather bowl + spoon</p>
  <p><span class="n">2</span>${state.order==='milk'?'Pour milk first to your level':'Add cereal first for ratio control'}</p>
  <p><span class="n">3</span>${state.order==='milk'?'Add cereal slowly to desired crunch':'Add milk slowly around edges'}</p>
  <p><span class="n">4</span>Optional toppings: fruit, nuts, honey</p>
  <p><span class="n">5</span>Enjoy immediately (cold milk = longer crunch)</p>
  <p class="no"><i>Tip: Save or print this page.</i></p>`;
  const blob = new Blob([html], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'cereal-job-aid.html'; a.click();
  setTimeout(()=>URL.revokeObjectURL(url), 600);
}

/* ---------- WIRE UP (no inline handlers) ---------- */
document.addEventListener('DOMContentLoaded', function () {
  const launch = document.getElementById('launchCourse');
  const jobAid = document.getElementById('jobAidBtn');
  const closeBtn = document.getElementById('closeCourse');
  const modal = document.getElementById('courseModal');

  if (launch) launch.addEventListener('click', openFullCourse);
  if (jobAid) jobAid.addEventListener('click', (e)=>{ e.preventDefault(); downloadJobAid(); });
  if (closeBtn) closeBtn.addEventListener('click', ()=> modal.classList.remove('active'));
  if (modal) modal.addEventListener('click', (e)=>{ if (e.target === modal) modal.classList.remove('active'); });
});
</script>
